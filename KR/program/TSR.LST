Turbo Assembler	 Version 3.1	    05/04/24 22:53:28	    Page 1
tsr.asm



      1				     ;		Символы по нажатию ESC
      2
      3	0000			     CODEPR  SEGMENT PARA
      4					      ASSUME CS:CODEPR , DS:CODEPR
      5					    ORG	 100H	      ;	Область PSP
      6				     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      7				     ; Резидентная часть
      8	0100  EB 27 90		     BEGIN:    JMP   INIT	       ; Переход	к части инициализации
      9				     ;	      Данные резидента
     10	0103  ????????		     SAVEINT9 DD  ?		    ; Сохранение старого обработчика
     11				     ;	 Новый обработчик прерывания 09Н
     12	0107  50		     NEWINT9: PUSH   AX		    ; Сохранение используемых		    +
     13				     регистров
     14	0108  51			PUSH   CX
     15	0109  53			PUSH   BX
     16				     ;	   Запрос	сканкода из клавиатуры
     17	010A  E4 60			     IN	    AL,	60H	   ; Взять	из порта	60 Н на регистр AL
     18	010C  3C 01			     CMP   AL, 1	   ; Проверка сканкода ESC он	равен 1
     19	010E  75 11			     JNE    EXIT	   ;   Переход если не ESC
     20				     ;	    Вывод на экран 10-ти символов	’В’ с помощью BIOS	    +
     21				     функции 0AH	– 010H
     22	0110  50			PUSH   AX
     23	0111  53			PUSH   BX
     24	0112  51			PUSH   CX
     25	0113  B4 0A			MOV AH , 0AH
     26	0115  B0 42			     MOV AL, 'B'
     27	0117  B7 00			     MOV BH , 0
     28	0119  B9 000A			     MOV CX, 10		    ; Число символов
     29	011C  CD 10			     INT 010H
     30	011E  59			     POP     CX
     31	011F  5B			     POP     BX
     32	0120  58			     POP     AX
     33				     ;	Восстановление регистров	и вызов старого		    +
     34				     обработчика без возврата
     35	0121  5B		     EXIT:   POP     BX
     36	0122  59			     POP     CX
     37	0123  58			     POP     AX
     38	0124  2E: FF 2E	0103r		     JMP  CS:SAVEINT9	   ; Вызов	старого обработчика
     39				     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     40				     ; Часть инициализации
     41	0129  FA		     INIT:    CLI		 ; Запрет	прерываний
     42				     ; Установка DS
     43	012A  0E			     PUSH CS
     44	012B  1F			     POP DS
     45				     ; Получение адреса старого обработчика
     46	012C  B4 35			     MOV  AH, 35H
     47	012E  B0 09			     MOV  AL, 09H    ; Номер прерывания
     48	0130  CD 21			     INT 21H
     49				     ;	Сохранение адреса старого обработчика
     50	0132  89 1E 0103r		     MOV     WORD  PTR	SAVEINT9 , BX
     51	0136  8C 06 0105r		     MOV     WORD  PTR	SAVEINT9+2 , ES
     52				     ;	Установка нового	обработчика в вектор прерывания
     53	013A  B4 25			     MOV     AH,25H
     54	013C  B0 09			     MOV     AL, 09H   ; Номер прерывания
     55	013E  BA 0107r			     MOV     DX, OFFSET	  NEWINT9
     56	0141  CD 21			     INT     21H
     57				     ; Вывод сообщения о	загрузке резидента
Turbo Assembler	 Version 3.1	    05/04/24 22:53:28	    Page 2
tsr.asm



     58	0143  B4 09			     MOV AH , 09H
     59	0145  BA 0153r			     MOV DX, OFFSET MSG
     60	0148  CD 21			     INT    21H
     61				     ; Завершить и оставить резидентной (TSR)
     62	014A  B8 3100			     MOV     AX, 3100H
     63	014D  BA 0013			     MOV     DX, (init - begin +10FH)/16   ; Размер резидента
     64	0150  FB			     STI		 ; Разрешение	прерываний
     65	0151  CD 21			     INT       21H
     66				     ;	Данные части	инициализации
     67	0153  53 74 61 72 74 20	54+  MSG      DB 'Start	TSR', 10,13,'$'
     68	      53 52 0A 0D 24
     69	015F			     CODEPR   ENDS
     70				     END     BEGIN
Turbo Assembler	 Version 3.1	    05/04/24 22:53:28	    Page 3
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "05/04/24"
??FILENAME			  Text	 "tsr	  "
??TIME				  Text	 "22:53:28"
??VERSION			  Number 030A
@CPU				  Text	 0101H
@CURSEG				  Text	 CODEPR
@FILENAME			  Text	 TSR
@WORDSIZE			  Text	 2
BEGIN				  Near	 CODEPR:0100
EXIT				  Near	 CODEPR:0121
INIT				  Near	 CODEPR:0129
MSG				  Byte	 CODEPR:0153
NEWINT9				  Near	 CODEPR:0107
SAVEINT9			  Dword	 CODEPR:0103

Groups & Segments		  Bit Size Align  Combine Class

CODEPR				  16  015F Para	  none
